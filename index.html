<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="Tam Ã¶zellikli PWA Ã¶rneÄŸi">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- iOS uyumluluk -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">

  <title>PWA Ã–rnek</title>

  <!-- Manifest ve favicon -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#0d1117">
  <link rel="icon" href="./icons/icon-192.png">

  <!-- Stil -->
  <link rel="stylesheet" href="./style.css">
</head>
<body class="dark">
  <!-- Splash Screen -->
  <div id="splash">
    <img src="./icons/icon-192.png" alt="logo">
    <h2>PWA Ã–rnek</h2>
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <p id="loadingText">YÃ¼kleniyor...</p>
  </div>

  <!-- Ana Ä°Ã§erik -->
  <main id="app" class="hidden">
    <h1>PWA Ã–rnek Uygulama</h1>
    <p>Bu sayfa offline Ã§alÄ±ÅŸÄ±r. Ana ekrana ekleyebilirsin.</p>
    <button id="installBtn" hidden>ðŸ“² Ana Ekrana Ekle</button>
  </main>

  <!-- Service Worker kaydÄ± -->
  <script src="./sw-register.js"></script>

  <!-- Splash Screen ve Tema -->
  <script>
    // Splash Screen progress simÃ¼lasyonu
    let progress = 0;
    const progressBar = document.getElementById("progressBar");
    const loadingText = document.getElementById("loadingText");

    const interval = setInterval(() => {
      progress += 10;
      if (progressBar) progressBar.style.width = progress + "%";
      if (loadingText) loadingText.textContent = `YÃ¼kleniyor... %${progress}`;

      if (progress >= 100) {
        clearInterval(interval);
        setTimeout(() => {
          const splash = document.getElementById("splash");
          const app = document.getElementById("app");
          if (splash) splash.classList.add("fade-out");
          setTimeout(() => {
            if (splash) splash.remove();
            if (app) app.classList.remove("hidden");
          }, 500);
        }, 200);
      }
    }, 100);

    // Tema algÄ±lama
    if (window.matchMedia('(prefers-color-scheme: light)').matches) {
      document.body.classList.remove("dark");
      document.body.classList.add("light");
    }
  </script>

  <!-- Ana Ekrana Ekle -->
  <script>
let deferredPrompt;
const installBtn = document.getElementById('installBtn');

// TarayÄ±cÄ± 'beforeinstallprompt' eventini yakala
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();      // TarayÄ±cÄ±nÄ±n otomatik promptunu engelle
  deferredPrompt = e;      // Eventâ€™i sakla
});

// Splash progress tamamlandÄ±ÄŸÄ±nda butonu gÃ¶ster
const splashCheck = setInterval(() => {
  const splash = document.getElementById('splash');
  const app = document.getElementById('app');

  // Splash tamamen gitti mi?
  if (!splash && app) {
    clearInterval(splashCheck);
    // Buton varsa ve deferredPrompt gelmiÅŸse gÃ¶ster
    if (installBtn && deferredPrompt) {
      installBtn.hidden = false;
    }
  }
}, 100);

// Butona tÄ±klandÄ±ÄŸÄ±nda promptu aÃ§
installBtn.addEventListener('click', async () => {
  if (!deferredPrompt) return; // Event gelmemiÅŸse Ã§Ä±k
  installBtn.hidden = true;    // Butonu gizle
  deferredPrompt.prompt();      // Ana ekrana ekleme promptunu aÃ§
  const choice = await deferredPrompt.userChoice;
  console.log('KullanÄ±cÄ± seÃ§imi:', choice.outcome);
  deferredPrompt = null;        // Eventâ€™i sÄ±fÄ±rla
});

// Uygulama yÃ¼klendiÄŸinde log
window.addEventListener('appinstalled', () => {
  console.log('Uygulama ana ekrana eklendi.');
});
</script>

</body>
</html>
